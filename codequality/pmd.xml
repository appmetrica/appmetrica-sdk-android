<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<ruleset xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd"
         name="appmetrica-pmd-ruleset">

    <description>AppMetrica PMD ruleset</description>

    <!-- ==================== Best Practices ==================== -->
    <rule ref="category/java/bestpractices.xml">
        <!-- Allows constructors and methods receiving arrays without cloning (sunsecure) -->
        <exclude name="ArrayIsStoredDirectly" />
        <!-- Allows returning internal arrays without copy (sunsecure) -->
        <exclude name="MethodReturnsInternalArray" />
        <!-- Merged from GuardLogStatementJavaUtil + GuardDebugLogging (logging) -->
        <exclude name="GuardLogStatement" />

        <!-- TODO: Temporary exceptions. https://nda.ya.ru/t/6pB_FOr57UYksX -->
        <exclude name="AbstractClassWithoutAbstractMethod" />
        <exclude name="AvoidPrintStackTrace" />
        <exclude name="AvoidReassigningLoopVariables" />
        <exclude name="AvoidReassigningParameters" />
        <exclude name="AvoidUsingHardCodedIP" />
        <exclude name="ConstantsInInterface" />
        <exclude name="DefaultLabelNotLastInSwitch" />
        <exclude name="DoubleBraceInitialization" />
        <exclude name="ExhaustiveSwitchHasDefault" />
        <exclude name="ForLoopCanBeForeach" />
        <exclude name="ImplicitFunctionalInterface" />
        <exclude name="LiteralsFirstInComparisons" />
        <exclude name="LooseCoupling" />
        <exclude name="MissingOverride" />
        <exclude name="NonExhaustiveSwitch" />
        <exclude name="PreserveStackTrace" />
        <exclude name="RelianceOnDefaultCharset" />
        <exclude name="SystemPrintln" />
        <exclude name="UnitTestContainsTooManyAsserts" />
        <exclude name="UnitTestShouldIncludeAssert" />
        <exclude name="UnitTestShouldUseTestAnnotation" />
        <exclude name="UnnecessaryVarargsArrayCreation" />
        <exclude name="UnnecessaryWarningSuppression" />
        <exclude name="UnusedAssignment" />
        <exclude name="UnusedFormalParameter" />
        <exclude name="UnusedLocalVariable" />
        <exclude name="UnusedPrivateMethod" />
        <exclude name="ForLoopVariableCount" />
        <exclude name="UseCollectionIsEmpty" />
        <exclude name="UseEnumCollections" />
        <exclude name="UseStandardCharsets" />
    </rule>

    <!-- ==================== Code Style ==================== -->
    <rule ref="category/java/codestyle.xml">
        <!-- Allows empty methods in abstract classes (design) -->
        <exclude name="EmptyMethodInAbstractClassShouldBeAbstract" />
        <!-- Allows non-final local variables (optimizations) -->
        <exclude name="LocalVariableCouldBeFinal" />
        <!-- Allows non-final method arguments (optimizations) -->
        <exclude name="MethodArgumentCouldBeFinal" />
        <!-- Allows too many static imports (imports) -->
        <exclude name="TooManyStaticImports" />
        <!-- Allows multiple return statements (controversial) -->
        <exclude name="OnlyOneReturn" />
        <!-- Allows unnecessary parentheses (controversial) -->
        <exclude name="UselessParentheses" />
        <!-- Allows classes without constructors (controversial) -->
        <exclude name="AtLeastOneConstructor" />
        <!-- Allows using native code (controversial) -->
        <exclude name="AvoidUsingNativeCode" />
        <!-- Allows not calling super in constructor (controversial) -->
        <exclude name="CallSuperInConstructor" />
        <!-- Allows long variable names (naming) -->
        <exclude name="LongVariable" />
        <!-- Allows short variable names (naming) -->
        <exclude name="ShortVariable" />

        <!-- TODO: Temporary exceptions. https://nda.ya.ru/t/6pB_FOr57UYksX -->
        <exclude name="ClassNamingConventions" />
        <exclude name="IdenticalCatchBranches" />
        <exclude name="CommentDefaultAccessModifier" />
        <exclude name="ConfusingTernary" />
        <exclude name="ControlStatementBraces" />
        <exclude name="EmptyControlStatement" />
        <exclude name="FieldDeclarationsShouldBeAtStartOfClass" />
        <exclude name="FieldNamingConventions" />
        <exclude name="FinalParameterInAbstractMethod" />
        <exclude name="LinguisticNaming" />
        <exclude name="LocalVariableNamingConventions" />
        <exclude name="MethodNamingConventions" />
        <exclude name="ModifierOrder" />
        <exclude name="PrematureDeclaration" />
        <exclude name="UnnecessaryConstructor" />
        <exclude name="ShortMethodName" />
        <exclude name="UnnecessaryBoxing" />
        <exclude name="UnnecessaryCast" />
        <exclude name="UnnecessaryModifier" />
        <exclude name="UnnecessarySemicolon" />
        <exclude name="UseDiamondOperator" />
        <exclude name="UselessQualifiedThis" />
        <exclude name="UseShortArrayInitializer" />
        <exclude name="UseUnderscoresInNumericLiterals" />
        <exclude name="VariableCanBeInlined" />
    </rule>

    <!-- ==================== Design ==================== -->
    <rule ref="category/java/design.xml">
        <!-- Allows nested conditions (basic) -->
        <exclude name="CollapsibleIfStatements" />
        <!-- Allows utility classes without private constructor (design) -->
        <exclude name="UseUtilityClass" />
        <!-- Allows excessive imports (coupling) -->
        <exclude name="ExcessiveImports" />
        <!-- Too coarse metric, use NcssCount and CyclomaticComplexity instead -->
        <exclude name="GodClass" />
        <!-- Data classes (DTOs, models) are standard practice in Android SDK -->
        <exclude name="DataClass" />
        <!-- Too noisy with builder pattern and fluent API -->
        <exclude name="LawOfDemeter" />

        <!-- TODO: Temporary exceptions. https://nda.ya.ru/t/6pB_FOr57UYksX -->
        <exclude name="AbstractClassWithoutAnyMethod" />
        <exclude name="AvoidCatchingGenericException" />
        <exclude name="AvoidDeeplyNestedIfStmts" />
        <exclude name="AvoidUncheckedExceptionsInSignatures" />
        <exclude name="AvoidThrowingRawExceptionTypes" />
        <exclude name="ClassWithOnlyPrivateConstructorsShouldBeFinal" />
        <exclude name="CognitiveComplexity" />
        <exclude name="CouplingBetweenObjects" />
        <exclude name="CyclomaticComplexity" />
        <exclude name="ExceptionAsFlowControl" />
        <exclude name="ExcessiveParameterList" />
        <exclude name="ExcessivePublicCount" />
        <exclude name="FinalFieldCouldBeStatic" />
        <exclude name="ImmutableField" />
        <exclude name="MutableStaticState" />
        <exclude name="NcssCount" />
        <exclude name="NPathComplexity" />
        <exclude name="SignatureDeclareThrowsException" />
        <exclude name="SimplifyBooleanExpressions" />
        <exclude name="SimplifyBooleanReturns" />
        <exclude name="SimplifyConditional" />
        <exclude name="SingularField" />
        <exclude name="SwitchDensity" />
        <exclude name="TooManyFields" />
        <exclude name="TooManyMethods" />
    </rule>

    <!-- ==================== Error Prone ==================== -->
    <rule ref="category/java/errorprone.xml">
        <!-- Allows non-static block initializer (design) -->
        <exclude name="NonStaticInitializer" />
        <!-- Allows catching Throwable errors (strictexception) -->
        <exclude name="AvoidCatchingThrowable" />
        <!-- Allows assigning null to variables (controversial) -->
        <exclude name="NullAssignment" />
        <!-- Allows assignments in operands (controversial) -->
        <exclude name="AssignmentInOperand" />
        <!-- Allows not calling super first (android) -->
        <exclude name="CallSuperFirst" />
        <!-- Allows not calling super last (android) -->
        <exclude name="CallSuperLast" />

        <!-- TODO: Temporary exceptions. https://nda.ya.ru/t/6pB_FOr57UYksX -->
        <exclude name="AssignmentToNonFinalStatic" />
        <exclude name="AvoidAccessibilityAlteration" />
        <exclude name="AvoidCatchingGenericException" />
        <exclude name="AvoidDuplicateLiterals" />
        <exclude name="AvoidFieldNameMatchingMethodName" />
        <exclude name="AvoidFieldNameMatchingTypeName" />
        <exclude name="AvoidLiteralsInIfCondition" />
        <exclude name="CloneMethodMustImplementCloneable" />
        <exclude name="CloneMethodReturnTypeMustMatchClassName" />
        <exclude name="CloseResource" />
        <exclude name="CompareObjectsWithEquals" />
        <exclude name="ConstructorCallsOverridableMethod" />
        <exclude name="DetachedTestCase" />
        <exclude name="DoNotExtendJavaLangThrowable" />
        <exclude name="EmptyCatchBlock" />
        <exclude name="ImplicitSwitchFallThrough" />
        <exclude name="MissingSerialVersionUID" />
        <exclude name="ProperCloneImplementation" />
        <exclude name="ReplaceJavaUtilCalendar" />
        <exclude name="ReplaceJavaUtilDate" />
        <exclude name="ReturnEmptyCollectionRatherThanNull" />
        <exclude name="SimpleDateFormatNeedsLocale" />
        <exclude name="SingletonClassReturningNewInstance" />
        <exclude name="TestClassWithoutTestCases" />
        <exclude name="UseLocaleWithCaseConversions" />
        <exclude name="UselessPureMethodCall" />
        <exclude name="UseProperClassLoader" />
    </rule>

    <!-- ==================== Multithreading ==================== -->
    <rule ref="category/java/multithreading.xml">
        <!-- Allows method-level synchronization (design) -->
        <exclude name="AvoidSynchronizedAtMethodLevel" />
        <!-- Allows using volatile keyword (controversial) -->
        <exclude name="AvoidUsingVolatile" />
        <!-- Allows developer to choose Map implementation (controversial) -->
        <exclude name="UseConcurrentHashMap" />

        <!-- TODO: Temporary exceptions. https://nda.ya.ru/t/6pB_FOr57UYksX -->
        <exclude name="AvoidSynchronizedStatement" />
        <exclude name="AvoidThreadGroup" />
        <exclude name="DoNotUseThreads" />
        <exclude name="DoubleCheckedLocking" />
    </rule>

    <!-- ==================== Performance ==================== -->
    <rule ref="category/java/performance.xml">
        <!-- Allows String.indexOf("?") instead of String.indexOf('?') (strings) -->
        <exclude name="UseIndexOfChar" />
        <!-- Allows instantiating objects inside loops (optimizations) -->
        <exclude name="AvoidInstantiatingObjectsInLoops" />
        <!-- Allows adding empty strings (optimizations) -->
        <exclude name="AddEmptyString" />

        <!-- TODO: Temporary exceptions. https://nda.ya.ru/t/6pB_FOr57UYksX -->
        <exclude name="AppendCharacterWithChar" />
        <exclude name="AvoidFileStream" />
        <exclude name="BigIntegerInstantiation" />
        <exclude name="ConsecutiveAppendsShouldReuse" />
        <exclude name="ConsecutiveLiteralAppends" />
        <exclude name="InefficientStringBuffering" />
        <exclude name="InsufficientStringBufferDeclaration" />
        <exclude name="OptimizableToArrayCall" />
        <exclude name="RedundantFieldInitializer" />
        <exclude name="TooFewBranchesForASwitchStatement" />
        <exclude name="TooFewBranchesForSwitch" />
    </rule>

    <!-- ==================== Security ==================== -->
    <rule ref="category/java/security.xml" />

</ruleset>
